// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// Modelo de Publicación
model publicacion {
  id                  String        @id @default(auto()) @map("_id") @db.ObjectId
  id_vendedor         Int           // ID del vendedor (referencia externa a otro microservicio)
  id_tienda           Int?          // ID de la tienda (referencia externa al microservicio de tiendas) - Opcional temporalmente
  id_producto         String?        // ID del producto (referencia externa al microservicio de productos)
  titulo              String
  descripcion         String
  estado              String        @default("en_revision") // Estados: "borrador", "en_revision", "activo", "pausado", "vendido", "rechazado", "eliminado"
  fecha_creacion      DateTime      @default(now())
  fecha_modificacion  DateTime      @updatedAt
  fecha_eliminacion   DateTime?     // Fecha en que se marcó como eliminado (para borrado automático después de 1 mes)
  multimedia          multimedia[]
  moderaciones        moderacion[]

  @@map("publicaciones")
}

// Modelo de Multimedia (imágenes/videos de la publicación)
model multimedia {
  id                      String        @id @default(auto()) @map("_id") @db.ObjectId
  publicacion             publicacion   @relation(fields: [id_publicacion], references: [id], onDelete: Cascade)
  id_publicacion          String        @db.ObjectId
  url                     String        // Link de la imagen/video guardado en repositorio
  cloudinary_public_id    String?       // Public ID de Cloudinary para poder eliminar la imagen
  orden                   Int           @default(0) // Orden numérico de la imagen
  tipo                    String        @default("imagen") // "imagen" o "video"

  @@map("multimedia")
}

// Modelo de Moderación
model moderacion {
  id                String        @id @default(auto()) @map("_id") @db.ObjectId
  publicacion       publicacion   @relation(fields: [id_publicacion], references: [id], onDelete: Cascade)
  id_publicacion    String        @db.ObjectId
  tipo_moderacion   String        // "automatica"
  accion            String        // "aprobado" o "rechazado"
  motivo            String        // Motivo del rechazo o aprobación
  palabras_detectadas String[]    @default([]) // Lista de palabras indebidas encontradas
  contenido_detectado String[]    @default([]) // Tipos de contenido detectado: "sexual", "armas", "drogas", etc.
  fecha             DateTime      @default(now())

  @@map("moderaciones")
}
